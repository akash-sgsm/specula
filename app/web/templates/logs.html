<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Threat Logs - Specula</title>
  <link rel="stylesheet" href="/static/styles.css">
  <link rel="stylesheet" href="logs-styles.css">
</head>
<body>
  <!-- Top Navigation -->
  <div class="top-nav">
    <a href="/" class="btn-back">â† Back to Dashboard</a>
  </div>

  <div class="container">
    <div class="header">
      <div class="header-main">
        <h1>ğŸ¥ Specula</h1>
        <p>A YOLO Based Threat Detection System</p>
      </div>
      <div class="developer-credits">
        Developed by <strong>Akash Sagolshem, Amarjeet Kumar & Ayush Chandravanshi</strong><br>
        <a href="https://github.com/akash-sgsm/specula.git" target="_blank">GitHub Repository</a>
      </div>
      <div class="threat-counter">ğŸ“‹ Total Threats Logged: {{ events|length }}</div>
    </div>

    {% if events %}
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>â° Time</th>
            <th>ğŸ¯ Threat Labels</th>
            <th>ğŸ“Š Score</th>
            <th>ğŸ“¸ Screenshot</th>
            <th>ğŸ“¤ Action</th>
          </tr>
        </thead>
        <tbody>
          {% for e in events %}
          <tr>
            <td class="timestamp">{{ e.timestamp }}</td>
            <td>
              <div class="labels">
                {% for label in e.labels.split(',') %}
                <span class="label-tag">{{ label.strip() }}</span>
                {% endfor %}
              </div>
            </td>
            <td class="score">{{ "%.3f"|format(e.score) }}</td>
            <td class="screenshot-cell">
              <img src="/screenshot/{{ e.id }}" width="200" class="screenshot" 
                   alt="Threat Screenshot" 
                   id="img-{{ e.id }}"
                   onerror="loadBase64Image({{ e.id }})"
                   onclick="showImageModal(this.src)">
              <div class="screenshot-placeholder" id="placeholder-{{ e.id }}" style="display:none;">
                ğŸ“¸ Image<br>Unavailable
              </div>
            </td>
            <td class="action-cell">
              <button onclick="sendAlert({{ e.id }}, '{{ e.labels }}', {{ e.score }})" class="btn btn-alert">
                âœ‰ï¸ Send Alert
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state">
      <p style="font-size: 3rem; margin-bottom: 10px;">âœ…</p>
      <p><strong>No Threats Detected</strong></p>
      <p>All systems operating normally</p>
    </div>
    {% endif %}
  </div>

  <!-- Success Modal -->
  <div id="successModal" class="modal">
    <div class="modal-content">
      <div class="success-checkmark">
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <circle class="check-circle" cx="50" cy="50" r="45"/>
          <polyline class="checkmark" points="30 55 45 70 70 40"/>
        </svg>
      </div>
      <div class="modal-title">Alert Sent!</div>
      <p class="modal-text">Your security alert has been sent successfully via SMS & Email</p>
      <button class="modal-button" onclick="closeModal()">Done</button>
    </div>
  </div>

  <!-- Image Modal -->
  <div id="imageModal" class="modal">
    <div class="modal-content">
      <img id="modalImage" src="" alt="Screenshot">
      <button class="modal-button" onclick="closeImageModal()">Close</button>
    </div>
  </div>

  <script src="logs-script.js"></script>
</body>
</html>
